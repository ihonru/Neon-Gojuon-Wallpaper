<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neon Gojuon Wallpaper</title>
    <style>
        :root {
            --bg-color: #050505;
            --text-color: #ffffff;
            --neon-blue: #00f3ff;
            --neon-pink: #ff00aa;
            --glass-bg: rgba(20, 20, 22, 0.95); /* Increased opacity slightly */
            --glass-border: rgba(255, 255, 255, 0.08);
            --font-jp: "Noto Sans JP", sans-serif;
            --font-mono: "JetBrains Mono", monospace;
        }

        body {
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: var(--font-jp);
            overflow: hidden;
            height: 100vh;
            user-select: none;
            display: flex;
            flex-direction: column;
        }

        /* --- Utilities --- */
        .hidden { display: none !important; }
        .flex { display: flex; }
        .flex-col { display: flex; flex-direction: column; }
        .items-center { align-items: center; }
        .justify-center { justify-content: center; }
        .gap-4 { gap: 1rem; }
        .gap-2 { gap: 0.5rem; }
        .absolute { position: absolute; }
        .relative { position: relative; }
        .z-50 { z-index: 50; }
        .w-full { width: 100%; }
        
        /* --- Glassmorphism --- */
        .glass {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
        }

        /* --- Header --- */
        header {
            position: absolute;
            top: 0;
            right: 0;
            padding: 2rem;
            display: flex;
            gap: 1rem;
            z-index: 100;
        }

        button {
            background: transparent;
            border: none;
            color: #888;
            font-family: var(--font-mono);
            font-size: 10px;
            font-weight: bold;
            letter-spacing: 2px;
            cursor: pointer;
            padding: 6px 16px;
            border-radius: 999px;
            transition: all 0.3s ease;
        }

        .mode-btn.active {
            background: white;
            color: black;
            box-shadow: 0 0 10px rgba(255,255,255,0.5);
        }

        .mode-btn:not(.active):hover {
            background: rgba(255,255,255,0.1);
            color: white;
        }

        /* --- Main Grid --- */
        main {
            flex-grow: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }

        .grid-container {
            display: flex;
            flex-direction: row-reverse; /* Japanese vertical text order usually goes Right to Left for columns */
            gap: 1.25rem;
        }

        .col {
            display: flex;
            flex-direction: column;
            gap: 1.25rem;
        }

        .cell {
            width: 3.5rem;
            height: 3.5rem;
            border-radius: 0.75rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
        }

        .cell:hover {
            background: rgba(255,255,255,0.05);
            border-color: rgba(255,255,255,0.2);
            transform: scale(1.05);
        }

        .cell.active {
            background: rgba(255,255,255,0.1);
            border-color: rgba(0, 243, 255, 0.4);
            transform: scale(1.05);
            z-index: 10;
        }

        .cell-main {
            font-size: 1.5rem;
            font-weight: 300;
            color: #ccc;
            line-height: 1;
            margin-bottom: 2px;
            transition: color 0.3s;
        }

        .cell.active .cell-main {
            color: var(--neon-blue);
            text-shadow: 0 0 8px rgba(0, 243, 255, 0.3);
        }

        .cell-sub {
            font-size: 9px;
            font-family: var(--font-mono);
            font-weight: bold;
            color: #555;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .cell.active .cell-sub {
            color: rgba(0, 243, 255, 0.7);
        }

        /* --- Info Panel --- */
        #info-panel {
            position: fixed;
            /* Changed from bottom: 2.5rem to bottom: 15% to avoid taskbar occlusion */
            bottom: 15%; 
            left: 0;
            right: 0;
            transition: all 0.5s cubic-bezier(0.16, 1, 0.3, 1);
            transform: translateY(20px);
            opacity: 0;
            pointer-events: none;
            z-index: 40;
            display: flex;
            justify-content: center;
        }

        #info-panel.show {
            transform: translateY(0);
            opacity: 1;
            pointer-events: auto;
        }

        .panel-card {
            width: 90%;
            max-width: 50rem;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 1.5rem;
            padding: 2.5rem 3rem;
            box-shadow: 0 10px 40px rgba(0,0,0,0.6);
            position: relative;
            overflow: hidden;
            min-height: 180px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-sizing: border-box;
        }

        .panel-bg-glow {
            position: absolute;
            inset: 0;
            background: linear-gradient(90deg, rgba(0,243,255,0.05), transparent, rgba(255,0,170,0.05));
            pointer-events: none;
        }

        /* --- Example Button (Inside Panel) --- */
        .btn-example {
            position: absolute;
            top: 1.5rem;
            right: 1.5rem;
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 50%;
            border: 1px solid var(--glass-border);
            color: #888;
            background: rgba(255,255,255,0.05);
            font-family: var(--font-jp);
            font-size: 0.9rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            padding: 0;
            transition: all 0.3s ease;
            z-index: 50;
        }

        .btn-example:hover {
            border-color: var(--neon-pink);
            color: var(--neon-pink);
            background: rgba(255, 0, 170, 0.1);
            box-shadow: 0 0 15px rgba(255, 0, 170, 0.3);
        }

        /* Character Details View */
        .char-view {
            display: flex;
            align-items: center;
            justify-content: center; 
            gap: 3rem;
            width: 100%;
            animation: fadeIn 0.5s ease-out;
        }

        .char-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 80px;
        }

        .char-label {
            font-size: 11px;
            font-family: var(--font-mono);
            letter-spacing: 2px;
            margin-bottom: 0.75rem;
            color: #666;
        }

        .char-val {
            font-size: 4rem;
            font-weight: 100;
            color: white;
            line-height: 1;
        }

        .divider {
            width: 1px;
            height: 5rem;
            background: rgba(255,255,255,0.1);
            margin: 0 1rem;
        }

        /* Vocab View */
        .vocab-view {
            width: 100%;
            display: flex;
            flex-direction: column;
            animation: fadeIn 0.5s ease-out;
        }
        
        .vocab-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding-bottom: 1rem;
            margin-bottom: 1rem;
            gap: 2rem;
            flex-wrap: wrap;
        }

        .vocab-main { display: flex; align-items: baseline; gap: 1rem; flex-wrap: wrap; }
        .vocab-word { font-size: 3rem; color: white; text-shadow: 0 0 10px rgba(255,255,255,0.2); line-height: 1; }
        .vocab-reading { font-size: 1.25rem; color: #888; white-space: nowrap; }
        
        .vocab-meaning { 
            color: var(--neon-blue); 
            font-size: 1.25rem; 
            font-weight: 300; 
            text-align: right;
            margin-left: auto;
            min-width: 120px;
        }

        .vocab-example { 
            background: rgba(255,255,255,0.05); 
            padding: 1rem 1.25rem;
            border-left: 3px solid rgba(255,0,170,0.5);
            color: #ccc;
            font-style: italic;
            font-size: 1rem;
            line-height: 1.5;
        }

        /* Loading & Error */
        .loading-view, .error-view {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1.25rem;
            animation: fadeIn 0.3s;
        }
        
        .pulse-bar {
            width: 100px;
            height: 4px;
            background: #222;
            border-radius: 99px;
            overflow: hidden;
        }
        .pulse-fill {
            height: 100%;
            width: 50%;
            background: var(--neon-pink);
            animation: slide 1s infinite ease-in-out alternate;
        }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes pulse { 50% { opacity: 0.5; } }
        @keyframes slide { from { transform: translateX(-50%); } to { transform: translateX(150%); } }

        /* Mobile tweaks */
        @media (max-width: 768px) {
            .grid-container { gap: 0.5rem; }
            .col { gap: 0.5rem; }
            .cell { width: 2.5rem; height: 2.5rem; }
            .char-val { font-size: 2.5rem; }
            header { padding: 1rem; }
            
            .panel-card {
                padding: 1.5rem;
                width: 94%;
                min-height: 140px;
            }
            .char-view { gap: 1rem; }
            .divider { margin: 0; height: 3rem; }
            .char-label { font-size: 9px; letter-spacing: 1px; }
            .char-group { min-width: auto; }
            
            .vocab-header { flex-direction: column; gap: 0.5rem; align-items: flex-start; }
            .vocab-meaning { text-align: left; margin-left: 0; font-size: 1rem; }
            .vocab-word { font-size: 2rem; }
            .vocab-reading { font-size: 1rem; }
        }
    </style>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@100;300;400;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
<script type="importmap">
{
  "imports": {
    "@google/genai": "https://esm.sh/@google/genai@^1.36.0",
    "react": "https://esm.sh/react@^19.2.3",
    "react/": "https://esm.sh/react@^19.2.3/"
  }
}
</script>
</head>
<body>

    <header>
        <div class="glass" style="display:flex; gap:4px; padding:4px; border-radius:99px;">
            <button class="mode-btn" data-mode="HIRAGANA">HIRA</button>
            <button class="mode-btn" data-mode="KATAKANA">KATA</button>
            <button class="mode-btn active" data-mode="BOTH">ALL</button>
        </div>
    </header>

    <main>
        <div id="grid-root" class="grid-container">
            <!-- Grid generated by JS -->
        </div>
    </main>

    <div id="info-panel">
        <div class="panel-card">
            <div class="panel-bg-glow"></div>
            <div id="panel-content" style="width: 100%;">
                <!-- Content injected by JS -->
            </div>
        </div>
    </div>

    <script type="module">
        // --- 1. Constants & Data ---
        // Helper to create char objects
        const c = (r, h, k) => ({ id: r, romaji: r, hiragana: h, katakana: k, type: 'main' });
        const empty = (id) => ({ id, type: 'empty' });

        const GOJUON_DATA = [
            // A Row
            c('a', 'あ', 'ア'), c('i', 'い', 'イ'), c('u', 'う', 'ウ'), c('e', 'え', 'エ'), c('o', 'お', 'オ'),
            // Ka Row
            c('ka', 'か', 'カ'), c('ki', 'き', 'キ'), c('ku', 'く', 'ク'), c('ke', 'け', 'ケ'), c('ko', 'こ', 'コ'),
            // Sa Row
            c('sa', 'さ', 'サ'), c('shi', 'し', 'シ'), c('su', 'す', 'ス'), c('se', 'せ', 'セ'), c('so', 'そ', 'ソ'),
            // Ta Row
            c('ta', 'た', 'タ'), c('chi', 'ち', 'チ'), c('tsu', 'つ', 'ツ'), c('te', 'て', 'テ'), c('to', 'と', 'ト'),
            // Na Row
            c('na', 'な', 'ナ'), c('ni', 'に', 'ニ'), c('nu', 'ぬ', 'ヌ'), c('ne', 'ね', 'ネ'), c('no', 'の', 'ノ'),
            // Ha Row
            c('ha', 'は', 'ハ'), c('hi', 'ひ', 'ヒ'), c('fu', 'ふ', 'フ'), c('he', 'へ', 'ヘ'), c('ho', 'ほ', 'ホ'),
            // Ma Row
            c('ma', 'ま', 'マ'), c('mi', 'み', 'ミ'), c('mu', 'む', 'ム'), c('me', 'め', 'メ'), c('mo', 'も', 'モ'),
            // Ya Row
            c('ya', 'や', 'ヤ'), empty('yi_e'), c('yu', 'ゆ', 'ユ'), empty('ye_e'), c('yo', 'よ', 'ヨ'),
            // Ra Row
            c('ra', 'ら', 'ラ'), c('ri', 'り', 'リ'), c('ru', 'る', 'ル'), c('re', 'れ', 'レ'), c('ro', 'ろ', 'ロ'),
            // Wa Row
            c('wa', 'わ', 'ワ'), empty('wi_e'), empty('wu_e'), empty('we_e'), c('wo', 'を', 'ヲ'),
            // N
            c('n', 'ん', 'ン')
        ];

        // --- LOCAL DATABASE (Offline Mode) ---
        const VOCAB_DB = {
            'a': [
                { word: '雨', reading: 'あめ (ame)', meaning: 'Rain', example: 'あめ が ふっている。 (It is raining.)' },
                { word: '朝', reading: 'あさ (asa)', meaning: 'Morning', example: 'あさごはん を たべる。 (I eat breakfast.)' },
                { word: '愛', reading: 'あい (ai)', meaning: 'Love', example: 'あい は たいせつ です。 (Love is important.)' }
            ],
            'i': [
                { word: '犬', reading: 'いぬ (inu)', meaning: 'Dog', example: 'いぬ が います。 (There is a dog.)' },
                { word: '家', reading: 'いえ (ie)', meaning: 'House', example: 'いえ に かえる。 (Go home.)' },
                { word: '今', reading: 'いま (ima)', meaning: 'Now', example: 'いま 何時 ですか？ (What time is it now?)' }
            ],
            'u': [
                { word: '海', reading: 'うみ (umi)', meaning: 'Sea/Ocean', example: 'うみ に いきたい。 (I want to go to the sea.)' },
                { word: '歌', reading: 'うた (uta)', meaning: 'Song', example: 'うた を うたう。 (Sing a song.)' },
                { word: '上', reading: 'うえ (ue)', meaning: 'Above/Up', example: 'つくえ の うえ。 (On the desk.)' }
            ],
            'e': [
                { word: '駅', reading: 'えき (eki)', meaning: 'Station', example: 'えき で まつ。 (Wait at the station.)' },
                { word: '鉛筆', reading: 'えんぴつ (enpitsu)', meaning: 'Pencil', example: 'えんぴつ で かく。 (Write with a pencil.)' },
                { word: '絵', reading: 'え (e)', meaning: 'Picture', example: 'え を みる。 (Look at the picture.)' }
            ],
            'o': [
                { word: '音楽', reading: 'おんがく (ongaku)', meaning: 'Music', example: 'おんがく を きく。 (Listen to music.)' },
                { word: 'お金', reading: 'おかね (okane)', meaning: 'Money', example: 'おかね が ない。 (I have no money.)' },
                { word: 'お茶', reading: 'おちゃ (ocha)', meaning: 'Tea', example: 'おちゃ を のむ。 (Drink tea.)' }
            ],
            'ka': [
                { word: '川', reading: 'かわ (kawa)', meaning: 'River', example: 'かわ で およぐ。 (Swim in the river.)' },
                { word: '傘', reading: 'かさ (kasa)', meaning: 'Umbrella', example: 'かさ を さす。 (Open an umbrella.)' },
                { word: '家族', reading: 'かぞく (kazoku)', meaning: 'Family', example: 'かぞく は 元気 です。 (My family is well.)' }
            ],
            'ki': [
                { word: '木', reading: 'き (ki)', meaning: 'Tree', example: 'おおきな き。 (A big tree.)' },
                { word: '昨日', reading: 'きのう (kinou)', meaning: 'Yesterday', example: 'きのう は あめ でした。 (It rained yesterday.)' },
                { word: '切符', reading: 'きっぷ (kippu)', meaning: 'Ticket', example: 'きっぷ を かう。 (Buy a ticket.)' }
            ],
            'ku': [
                { word: '車', reading: 'くるま (kuruma)', meaning: 'Car', example: 'くるま を うんてん する。 (Drive a car.)' },
                { word: '靴', reading: 'くつ (kutsu)', meaning: 'Shoes', example: 'くつ を はく。 (Put on shoes.)' },
                { word: '国', reading: 'くに (kuni)', meaning: 'Country', example: 'どの くに から きましたか？ (Which country are you from?)' }
            ],
            'ke': [
                { word: '警察', reading: 'けいさつ (keisatsu)', meaning: 'Police', example: 'けいさつ を よぶ。 (Call the police.)' },
                { word: '結婚', reading: 'けっこん (kekkon)', meaning: 'Marriage', example: 'けっこん します。 (Getting married.)' },
                { word: '景色', reading: 'けしき (keshiki)', meaning: 'Scenery', example: 'いい けしき です。 (It is good scenery.)' }
            ],
            'ko': [
                { word: '子供', reading: 'こども (kodomo)', meaning: 'Child', example: 'こども が あそぶ。 (Children are playing.)' },
                { word: '声', reading: 'こえ (koe)', meaning: 'Voice', example: 'おおきな こえ。 (Big voice.)' },
                { word: '心', reading: 'こころ (kokoro)', meaning: 'Heart', example: 'こころ が あたたかい。 (Warm hearted.)' }
            ],
            'sa': [
                { word: '魚', reading: 'さかな (sakana)', meaning: 'Fish', example: 'さかな を たべる。 (Eat fish.)' },
                { word: '酒', reading: 'さけ (sake)', meaning: 'Sake/Alcohol', example: 'さけ を のむ。 (Drink sake.)' },
                { word: '桜', reading: 'さくら (sakura)', meaning: 'Cherry Blossom', example: 'さくら が さいた。 (Cherry blossoms bloomed.)' }
            ],
            'shi': [
                { word: '新聞', reading: 'しんぶん (shinbun)', meaning: 'Newspaper', example: 'しんぶん を よむ。 (Read the newspaper.)' },
                { word: '仕事', reading: 'しごと (shigoto)', meaning: 'Work', example: 'しごと に いく。 (Go to work.)' },
                { word: '写真', reading: 'しゃしん (shashin)', meaning: 'Photo', example: 'しゃしん を とる。 (Take a photo.)' }
            ],
            'su': [
                { word: '寿司', reading: 'すし (sushi)', meaning: 'Sushi', example: 'すし が すき です。 (I like sushi.)' },
                { word: '少し', reading: 'すこし (sukoshi)', meaning: 'A little', example: 'すこし つかれました。 (I am a little tired.)' },
                { word: '好き', reading: 'すき (suki)', meaning: 'Like', example: 'これ が すき です。 (I like this.)' }
            ],
            'se': [
                { word: '先生', reading: 'せんせい (sensei)', meaning: 'Teacher', example: 'せんせい に きく。 (Ask the teacher.)' },
                { word: '生活', reading: 'せいかつ (seikatsu)', meaning: 'Life/Living', example: 'たのしい せいかつ。 (Fun life.)' },
                { word: '背中', reading: 'せなか (senaka)', meaning: 'Back (body)', example: 'せなか が かゆい。 (My back is itchy.)' }
            ],
            'so': [
                { word: '空', reading: 'そら (sora)', meaning: 'Sky', example: 'あおい そら。 (Blue sky.)' },
                { word: '外', reading: 'そと (soto)', meaning: 'Outside', example: 'そと に でる。 (Go outside.)' },
                { word: '掃除', reading: 'そうじ (souji)', meaning: 'Cleaning', example: 'へや を そうじ する。 (Clean the room.)' }
            ],
            'ta': [
                { word: '食べる', reading: 'たべる (taberu)', meaning: 'To eat', example: 'ごはん を たべる。 (Eat rice.)' },
                { word: '高い', reading: 'たかい (takai)', meaning: 'High/Expensive', example: 'これ は たかい です。 (This is expensive.)' },
                { word: '太陽', reading: 'たいよう (taiyou)', meaning: 'Sun', example: 'たいよう が のぼる。 (The sun rises.)' }
            ],
            'chi': [
                { word: '地下鉄', reading: 'ちかてつ (chikatetsu)', meaning: 'Subway', example: 'ちかてつ に のる。 (Ride the subway.)' },
                { word: '地図', reading: 'ちず (chizu)', meaning: 'Map', example: 'ちず を みる。 (Look at the map.)' },
                { word: '父', reading: 'ちち (chichi)', meaning: 'Father', example: 'ちち は かいしゃいん です。 (My father is an office worker.)' }
            ],
            'tsu': [
                { word: '月', reading: 'つき (tsuki)', meaning: 'Moon', example: 'つき が きれい です。 (The moon is beautiful.)' },
                { word: '机', reading: 'つくえ (tsukue)', meaning: 'Desk', example: 'つくえ で べんきょう する。 (Study at the desk.)' },
                { word: '強い', reading: 'つよい (tsuyoi)', meaning: 'Strong', example: 'かぜ が つよい。 (The wind is strong.)' }
            ],
            'te': [
                { word: '手', reading: 'て (te)', meaning: 'Hand', example: 'て を あらう。 (Wash hands.)' },
                { word: '天気', reading: 'てんき (tenki)', meaning: 'Weather', example: 'きょう は いい てんき です。 (Today is good weather.)' },
                { word: '手紙', reading: 'てがみ (tegami)', meaning: 'Letter', example: 'てがみ を かく。 (Write a letter.)' }
            ],
            'to': [
                { word: '時計', reading: 'とけい (tokei)', meaning: 'Clock/Watch', example: 'とけい を みる。 (Check the watch.)' },
                { word: '友達', reading: 'ともだち (tomodachi)', meaning: 'Friend', example: 'ともだち と あそぶ。 (Play with a friend.)' },
                { word: '図書館', reading: 'としょかん (toshokan)', meaning: 'Library', example: 'としょかん に いく。 (Go to the library.)' }
            ],
            'na': [
                { word: '名前', reading: 'なまえ (namae)', meaning: 'Name', example: 'なまえ を かく。 (Write your name.)' },
                { word: '夏', reading: 'なつ (natsu)', meaning: 'Summer', example: 'なつ は あつい です。 (Summer is hot.)' },
                { word: '中', reading: 'なか (naka)', meaning: 'Inside', example: 'はこ の なか。 (Inside the box.)' }
            ],
            'ni': [
                { word: '日本', reading: 'にほん (nihon)', meaning: 'Japan', example: 'にほん に いきたい。 (I want to go to Japan.)' },
                { word: '肉', reading: 'にく (niku)', meaning: 'Meat', example: 'にく を たべる。 (Eat meat.)' },
                { word: '日曜日', reading: 'にちようび (nichiyoubi)', meaning: 'Sunday', example: 'あした は にちようび です。 (Tomorrow is Sunday.)' }
            ],
            'nu': [
                { word: 'ぬいぐるみ', reading: 'ぬいぐるみ (nuigurumi)', meaning: 'Stuffed Animal', example: 'くま の ぬいぐるみ。 (Bear stuffed animal.)' },
                { word: '盗む', reading: 'ぬすむ (nusumu)', meaning: 'To steal', example: 'さいふ を ぬすまれる。 (Wallet gets stolen.)' },
                { word: 'ぬるい', reading: 'ぬるい (nurui)', meaning: 'Lukewarm', example: 'おゆ が ぬるい。 (The water is lukewarm.)' }
            ],
            'ne': [
                { word: '猫', reading: 'ねこ (neko)', meaning: 'Cat', example: 'ねこ が ねている。 (The cat is sleeping.)' },
                { word: '寝る', reading: 'ねる (neru)', meaning: 'To sleep', example: 'はやく ねる。 (Go to sleep early.)' },
                { word: '熱', reading: 'ねつ (netsu)', meaning: 'Fever', example: 'ねつ が ある。 (I have a fever.)' }
            ],
            'no': [
                { word: '飲み物', reading: 'のみもの (nomimono)', meaning: 'Drink', example: 'のみもの を かう。 (Buy a drink.)' },
                { word: '乗り物', reading: 'のりもの (norimono)', meaning: 'Vehicle', example: 'のりもの に のる。 (Ride a vehicle.)' },
                { word: '喉', reading: 'のど (nodo)', meaning: 'Throat', example: 'のど が かわいた。 (I am thirsty.)' }
            ],
            'ha': [
                { word: '花', reading: 'はな (hana)', meaning: 'Flower', example: 'はな が さく。 (Flowers bloom.)' },
                { word: '春', reading: 'はる (haru)', meaning: 'Spring', example: 'はる に なる。 (It becomes spring.)' },
                { word: '晴れ', reading: 'はれ (hare)', meaning: 'Sunny', example: 'あした は はれ です。 (Tomorrow will be sunny.)' }
            ],
            'hi': [
                { word: '人', reading: 'ひと (hito)', meaning: 'Person', example: 'やさしい ひと。 (A kind person.)' },
                { word: '飛行機', reading: 'ひこうき (hikouki)', meaning: 'Airplane', example: 'ひこうき で いく。 (Go by plane.)' },
                { word: '昼', reading: 'ひる (hiru)', meaning: 'Noon/Daytime', example: 'ひるごはん を たべる。 (Eat lunch.)' }
            ],
            'fu': [
                { word: '冬', reading: 'ふゆ (fuyu)', meaning: 'Winter', example: 'ふゆ は さむい です。 (Winter is cold.)' },
                { word: '服', reading: 'ふく (fuku)', meaning: 'Clothes', example: 'ふく を かう。 (Buy clothes.)' },
                { word: '富士山', reading: 'ふじさん (fujisan)', meaning: 'Mt. Fuji', example: 'ふじさん は たかい。 (Mt. Fuji is high.)' }
            ],
            'he': [
                { word: '部屋', reading: 'へや (heya)', meaning: 'Room', example: 'へや を かたづける。 (Clean the room.)' },
                { word: '平和', reading: 'へいわ (heiwa)', meaning: 'Peace', example: 'せかい の へいわ。 (World peace.)' },
                { word: '下手', reading: 'へた (heta)', meaning: 'Unskilled', example: 'うた が へた です。 (I am bad at singing.)' }
            ],
            'ho': [
                { word: '本', reading: 'ほん (hon)', meaning: 'Book', example: 'ほん を よむ。 (Read a book.)' },
                { word: '星', reading: 'ほし (hoshi)', meaning: 'Star', example: 'ほし が ひかる。 (Stars shine.)' },
                { word: '欲しい', reading: 'ほしい (hoshii)', meaning: 'Want', example: 'みず が ほしい。 (I want water.)' }
            ],
            'ma': [
                { word: '毎日', reading: 'まいにち (mainichi)', meaning: 'Every day', example: 'まいにち べんきょう する。 (Study every day.)' },
                { word: '前', reading: 'まえ (mae)', meaning: 'Front/Before', example: 'いえ の まえ。 (In front of the house.)' },
                { word: '窓', reading: 'まど (mado)', meaning: 'Window', example: 'まど を あける。 (Open the window.)' }
            ],
            'mi': [
                { word: '店', reading: 'みせ (mise)', meaning: 'Shop', example: 'みせ に いく。 (Go to the shop.)' },
                { word: '道', reading: 'みち (michi)', meaning: 'Road', example: 'みち を あるく。 (Walk on the road.)' },
                { word: '耳', reading: 'みみ (mimi)', meaning: 'Ear', example: 'みみ が いたい。 (My ear hurts.)' }
            ],
            'mu': [
                { word: '虫', reading: 'むし (mushi)', meaning: 'Insect', example: 'むし が いる。 (There is an insect.)' },
                { word: '村', reading: 'むら (mura)', meaning: 'Village', example: 'ちいさな むら。 (Small village.)' },
                { word: '昔', reading: 'むかし (mukashi)', meaning: 'Long ago', example: 'むかし むかし... (Once upon a time...)' }
            ],
            'me': [
                { word: '目', reading: 'め (me)', meaning: 'Eye', example: 'め が かゆい。 (My eyes are itchy.)' },
                { word: '眼鏡', reading: 'めがね (megane)', meaning: 'Glasses', example: 'めがね を かける。 (Wear glasses.)' },
                { word: '名刺', reading: 'めいし (meishi)', meaning: 'Business Card', example: 'めいし を こうかん する。 (Exchange business cards.)' }
            ],
            'mo': [
                { word: '森', reading: 'もり (mori)', meaning: 'Forest', example: 'もり に いく。 (Go to the forest.)' },
                { word: '物', reading: 'もの (mono)', meaning: 'Thing', example: 'おいしい もの。 (Delicious thing.)' },
                { word: 'もしもし', reading: 'もしもし (moshimoshi)', meaning: 'Hello (phone)', example: 'もしもし、げんき ですか？ (Hello, are you well?)' }
            ],
            'ya': [
                { word: '山', reading: 'やま (yama)', meaning: 'Mountain', example: 'やま に のぼる。 (Climb a mountain.)' },
                { word: '野菜', reading: 'やさい (yasai)', meaning: 'Vegetable', example: 'やさい を たべる。 (Eat vegetables.)' },
                { word: '休み', reading: 'やすみ (yasumi)', meaning: 'Rest/Holiday', example: 'あした は やすみ です。 (Tomorrow is a holiday.)' }
            ],
            'yu': [
                { word: '雪', reading: 'ゆき (yuki)', meaning: 'Snow', example: 'ゆき が ふる。 (Snow falls.)' },
                { word: '夢', reading: 'ゆめ (yume)', meaning: 'Dream', example: 'ゆめ を みる。 (Have a dream.)' },
                { word: 'ゆっくり', reading: 'ゆっくり (yukkuri)', meaning: 'Slowly', example: 'ゆっくり はなして ください。 (Please speak slowly.)' }
            ],
            'yo': [
                { word: '夜', reading: 'よる (yoru)', meaning: 'Night', example: 'よる に なる。 (It becomes night.)' },
                { word: '読む', reading: 'よむ (yomu)', meaning: 'To read', example: 'ほん を よむ。 (Read a book.)' },
                { word: '洋服', reading: 'ようふく (youfuku)', meaning: 'Western clothes', example: 'ようふく を きる。 (Wear western clothes.)' }
            ],
            'ra': [
                { word: '来週', reading: 'らいしゅう (raishuu)', meaning: 'Next week', example: 'らいしゅう あいましょう。 (Let\'s meet next week.)' },
                { word: 'ラーメン', reading: 'らーめん (raamen)', meaning: 'Ramen', example: 'ラーメン を たべる。 (Eat ramen.)' },
                { word: '楽', reading: 'らく (raku)', meaning: 'Comfortable/Easy', example: 'らく に して ください。 (Please make yourself comfortable.)' }
            ],
            'ri': [
                { word: '林檎', reading: 'りんご (ringo)', meaning: 'Apple', example: 'りんご を たべる。 (Eat an apple.)' },
                { word: '料理', reading: 'りょうり (ryouri)', meaning: 'Cooking', example: 'りょうり を つくる。 (Cook food.)' },
                { word: '旅行', reading: 'りょこう (ryokou)', meaning: 'Travel', example: 'りょこう に いく。 (Go on a trip.)' }
            ],
            'ru': [
                { word: '留守', reading: 'るす (rusu)', meaning: 'Not at home', example: 'ちち は るす です。 (My father is not home.)' },
                { word: 'ルール', reading: 'るーる (ruuru)', meaning: 'Rule', example: 'ルール を まもる。 (Follow the rules.)' },
                { word: 'ルビー', reading: 'るびー (rubii)', meaning: 'Ruby', example: 'あかい ルビー。 (Red ruby.)' }
            ],
            're': [
                { word: '冷蔵庫', reading: 'れいぞうこ (reizouko)', meaning: 'Refrigerator', example: 'れいぞうこ に いれる。 (Put in the refrigerator.)' },
                { word: '練習', reading: 'れんしゅう (renshuu)', meaning: 'Practice', example: 'ピアノ を れんしゅう する。 (Practice piano.)' },
                { word: '歴史', reading: 'れきし (rekishi)', meaning: 'History', example: 'れきし を べんきょう する。 (Study history.)' }
            ],
            'ro': [
                { word: '六', reading: 'ろく (roku)', meaning: 'Six', example: 'りんご が ろっこ ある。 (There are six apples.)' },
                { word: '廊下', reading: 'ろうか (rouka)', meaning: 'Corridor', example: 'ろうか を はしらない。 (Do not run in the corridor.)' },
                { word: '老人', reading: 'ろうじん (roujin)', meaning: 'Elderly person', example: 'ろうじん に しんせつ に する。 (Be kind to the elderly.)' }
            ],
            'wa': [
                { word: '私', reading: 'わたし (watashi)', meaning: 'I/Me', example: 'わたし は ガク です。 (I am Gaku.)' },
                { word: '忘れる', reading: 'わすれる (wasureru)', meaning: 'To forget', example: 'しゅくだい を わすれた。 (I forgot my homework.)' },
                { word: '笑う', reading: 'わらう (warau)', meaning: 'To laugh', example: 'おおきく わらう。 (Laugh loudly.)' }
            ],
            'wo': [
                { word: 'を', reading: 'を (wo)', meaning: 'Object particle', example: 'これ を ください。 (Please give me this.)' },
                // 'Wo' is rarely start of word, usually particle.
            ],
            'n': [
                { word: '運', reading: 'うん (un)', meaning: 'Luck', example: 'うん が いい。 (Good luck.)' },
                // N usually ends words, but we can list words containing it significantly or just concepts.
            ]
        };

        // --- 2. State ---
        const state = {
            mode: 'BOTH',
            selectedChar: null,
            isGenerating: false,
            vocabulary: null,
            error: null
        };

        // --- 3. Render Logic ---
        const gridRoot = document.getElementById('grid-root');
        const infoPanel = document.getElementById('info-panel');
        const panelContent = document.getElementById('panel-content');
        const modeBtns = document.querySelectorAll('.mode-btn');

        // Initial Render
        function initGrid() {
            gridRoot.innerHTML = '';
            // Chunk into columns of 5
            for (let i = 0; i < GOJUON_DATA.length; i += 5) {
                const chunk = GOJUON_DATA.slice(i, i + 5);
                const col = document.createElement('div');
                col.className = 'col';
                
                chunk.forEach(char => {
                    const cell = document.createElement('div');
                    if (char.type === 'empty') {
                        cell.style.width = '3.5rem';
                        cell.style.height = '3.5rem';
                    } else {
                        cell.className = 'cell';
                        cell.id = `cell-${char.id}`;
                        // Stop propagation so clicking a cell doesn't immediately close the panel
                        cell.onclick = (e) => {
                            e.stopPropagation();
                            selectChar(char);
                        };
                        
                        // Main Text
                        const mainSpan = document.createElement('span');
                        mainSpan.className = 'cell-main';
                        cell.appendChild(mainSpan);

                        // Sub Text
                        const subSpan = document.createElement('span');
                        subSpan.className = 'cell-sub';
                        cell.appendChild(subSpan);
                    }
                    col.appendChild(cell);
                });
                gridRoot.appendChild(col);
            }
            updateGridVisuals();
        }

        function updateGridVisuals() {
            GOJUON_DATA.forEach(char => {
                if (char.type === 'empty') return;
                const cell = document.getElementById(`cell-${char.id}`);
                const main = cell.querySelector('.cell-main');
                const sub = cell.querySelector('.cell-sub');
                
                // Update text based on mode
                if (state.mode === 'HIRAGANA') {
                    main.textContent = char.hiragana;
                    sub.textContent = char.romaji;
                } else if (state.mode === 'KATAKANA') {
                    main.textContent = char.katakana;
                    sub.textContent = char.romaji;
                } else {
                    main.textContent = char.hiragana;
                    sub.textContent = char.katakana;
                }

                // Active State
                if (state.selectedChar && state.selectedChar.id === char.id) {
                    cell.classList.add('active');
                } else {
                    cell.classList.remove('active');
                }
            });
        }

        function updatePanel() {
            // Visibility
            if (!state.selectedChar) {
                infoPanel.classList.remove('show');
                return;
            }

            infoPanel.classList.add('show');

            // Content
            panelContent.innerHTML = '';

            if (state.isGenerating) {
                // Loading View
                panelContent.innerHTML = `
                    <div class="loading-view">
                        <div style="font-size:10px; letter-spacing:2px; color:var(--neon-pink);">ACCESSING NEURAL ARCHIVE...</div>
                        <div class="pulse-bar"><div class="pulse-fill"></div></div>
                    </div>
                `;
            } else if (state.error) {
                // Error View
                panelContent.innerHTML = `
                    <div class="error-view">
                        <div style="border:1px solid var(--neon-pink); padding:2px 6px; font-size:10px; color:var(--neon-pink);">SYSTEM WARNING</div>
                        <div style="font-weight:300;">${state.error}</div>
                    </div>
                `;
            } else if (state.vocabulary) {
                // Vocabulary View
                const v = state.vocabulary;
                panelContent.innerHTML = `
                    <div class="vocab-view">
                        <div class="vocab-header">
                            <div>
                                <div style="font-size:10px; color:var(--neon-pink); letter-spacing:2px; margin-bottom:4px;">VOCABULARY</div>
                                <div class="vocab-main">
                                    <span class="vocab-word">${v.word}</span>
                                    <span class="vocab-reading">${v.reading}</span>
                                </div>
                            </div>
                            <div class="vocab-meaning">${v.meaning}</div>
                        </div>
                        <div class="vocab-example">"${v.example}"</div>
                    </div>
                `;
            } else {
                // Default Char View
                const c = state.selectedChar;
                panelContent.innerHTML = `
                    <button class="btn-example" id="btn-example-trigger">例</button>
                    <div class="char-view">
                        <div class="char-group">
                            <span class="char-label">HIRAGANA</span>
                            <span class="char-val">${c.hiragana}</span>
                        </div>
                        <div class="divider"></div>
                        <div class="char-group">
                            <span class="char-label" style="color:var(--neon-pink);">KATAKANA</span>
                            <span class="char-val">${c.katakana}</span>
                        </div>
                        <div class="divider"></div>
                        <div class="char-group">
                            <span class="char-label" style="color:var(--neon-blue);">ROMAJI</span>
                            <span class="char-val" style="font-size:3rem; font-family:var(--font-mono);">${c.romaji}</span>
                        </div>
                    </div>
                `;
            }
        }

        // --- 4. Interactions ---
        function selectChar(char) {
            state.selectedChar = char;
            state.vocabulary = null;
            state.error = null;
            updateGridVisuals();
            updatePanel();
        }

        modeBtns.forEach(btn => {
            btn.addEventListener('click', (e) => {
                e.stopPropagation(); // Stop clicking header from closing panel
                modeBtns.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                state.mode = btn.dataset.mode;
                updateGridVisuals();
            });
        });

        // Click outside to close
        window.addEventListener('click', (e) => {
            // If the click is NOT inside the panel and NOT inside a cell (cell is handled by stopPropagation)
            if (!infoPanel.contains(e.target)) {
                state.selectedChar = null;
                updateGridVisuals();
                updatePanel();
            }
        });

        // Event delegation for the dynamic Example button
        panelContent.addEventListener('click', (e) => {
            if (e.target.closest('#btn-example-trigger')) {
                e.stopPropagation();
                generateVocab();
            }
        });

        // --- 5. OFFLINE LOGIC ---
        function generateVocab() {
            if (!state.selectedChar) return;
            
            state.isGenerating = true;
            state.vocabulary = null;
            state.error = null;
            updatePanel();

            // Simulate "Network/Processing" delay for effect
            setTimeout(() => {
                try {
                    const charId = state.selectedChar.id;
                    const vocabList = VOCAB_DB[charId];

                    if (vocabList && vocabList.length > 0) {
                        // Pick random word
                        const randomIndex = Math.floor(Math.random() * vocabList.length);
                        state.vocabulary = vocabList[randomIndex];
                    } else {
                        state.error = "No data found in local archive.";
                    }
                } catch (e) {
                    state.error = "Data access error.";
                } finally {
                    state.isGenerating = false;
                    updatePanel();
                }
            }, 600); // 600ms artificial delay
        }

        initGrid();

    </script>
</body>
</html>